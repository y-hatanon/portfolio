// _mixins.scss
@use "variables" as *;
@use "sass:map";
@use "sass:math";
@use "image-sizes" as *;


@function rate($size, $rate) {
  @return math.div($size, $rate) * 100vw;
}

@mixin image-replace {
  font: 0/0 a;
  text-indent: 100%;
  white-space: nowrap;
  overflow: hidden;
}

/// 画像名から背景画像・サイズ・アスペクト比を一括適用
/// @param {string} $image-name - `$image-sizes`に定義された画像名
/// @param {number} $rate - 画面の最大幅
@mixin rsp_bg_img($image-name, $rate: $rateL, $text: false) {
  $size-map: map.get($image-sizes, $image-name);

  @if $size-map == null {
    @error "Image size for '#{$image-name}' not found in \$image-sizes.";
  }

  $img-width: map.get($size-map, "width");
  $img-height: map.get($size-map, "height");

  // レートによるサイズ調整
  @if $rate == $rateS {
    $img-width: math.div($img-width, 2);
    $img-height: math.div($img-height, 2);
  } @else if $rate == $rateM {
    $img-width: math.div($img-width, 2);
    $img-height: math.div($img-height, 2);
  } @else if $rate == $rateL {
    // 何もしない
  } @else {
    @warn "Unsupported rate: #{$rate}. Supported rates are: #{$rateS}, #{$rateM}, #{$rateL}.";
  }

  $img-width-vw: math.div($img-width, $rate) * 100vw;

  background-image: url('/images/#{$image-name}');
  background-position: center center;
  background-repeat: no-repeat;
  background-size: cover;
  width: $img-width-vw;
  max-width: 100vw;
  aspect-ratio: math.div($img-width, $img-height);
  
  @if $text == true {
    @include image-replace;
  }
}