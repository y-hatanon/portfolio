// _mixins.scss
@use "variables" as *;
@use "sass:map";
@use "sass:math";
@use "image-sizes" as *;

// 小数点以下3桁で四捨五入
@function round-num($number) {
  @return math.div(math.round($number * 1000), 1000);
}

// レスポンシブ対応のフォントサイズ・要素サイズ計算
@function rate($size, $rate) {
  $result: math.div($size, $rate) * 100vw;
  @return round-num($result);
}  

@mixin image-replace {
  font: 0/0 a;
  text-indent: 100%;
  white-space: nowrap;
  overflow: hidden;
}

/// 画像名から背景画像・サイズ・アスペクト比を一括適用
/// @param {string} $image-name - `$image-sizes`に定義された画像名
/// @param {number} $rate - 画面の最大幅
@mixin rsp_bg_img($image-name, $rate: $rateL, $text: false) {
  $size-map: map.get($image-sizes, $image-name);

  @if $size-map == null {
    @error "Image size for '#{$image-name}' not found in \$image-sizes.";
  }

  $img-width: map.get($size-map, "width");
  $img-height: map.get($size-map, "height");
  $width: math.div($img-width, 1);
  $height: math.div($img-height, 1);

  // レートによるサイズ調整
  @if $rate == $rateS {
    $width: math.div($img-width, 2);
    $height: math.div($img-height, 2);
  } @else if $rate == $rateM {
    $width: math.div($img-width, 1.5);
    $height: math.div($img-height, 1.5);
  } @else if $rate == $rateL {
    // 何もしない
  } @else {
    @warn "Unsupported rate: #{$rate}. Supported rates are: #{$rateS}, #{$rateM}, #{$rateL}.";
  }

  background-image: url('images/#{$image-name}');
  background-position: center center;
  background-repeat: no-repeat;
  background-size: cover;
  width: round-num(math.div($width, $rate) * 100vw);
  height: round-num(math.div($height, $rate) * 100vw);
  max-width: 100vw;
  aspect-ratio: round-num(math.div($width, $height));

  @if $text == true {
    @include image-replace;
  }
}